Credit to hexception for this event system